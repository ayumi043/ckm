function Music(){this.init()}(function(){var e=[],t=[],i=null;Music.prototype={total:70,pageSize:10,dataUrl:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common",playerUrl:"http://box.baidu.com/widget/flash/bdspacesong.swf",init:function(){var e=this;domUtils.on($G("J_searchName"),"keyup",function(t){var i=window.event||t;13==i.keyCode&&e.dosearch()}),domUtils.on($G("J_searchBtn"),"click",function(){e.dosearch()})},callback:function(e){var t=this;t.data=e.song_list,setTimeout(function(){$G("J_resultBar").innerHTML=t._renderTemplate(e.song_list)},300)},dosearch:function(){var e=this;i=null;var t=$G("J_searchName").value;return""==utils.trim(t)?!1:(t=encodeURIComponent(t),e._sent(t),void 0)},doselect:function(e){var t=this;"object"==typeof e?i=e:"number"==typeof e&&(i=t.data[e])},onpageclick:function(i){for(var n=0;e.length>n;n++)$G(e[n]).className="pageoff",$G(t[n]).className="paneloff";$G("page"+i).className="pageon",$G("panel"+i).className="panelon"},listenTest:function(e){var t=this,i=$G("J_preview"),n="m-try"==e.className,o=t._getTryingElem();o&&(o.className="m-try",i.innerHTML=""),n&&(e.className="m-trying",i.innerHTML=t._buildMusicHtml(t._getUrl(!0)))},_sent:function(e){var t=this;$G("J_resultBar").innerHTML='<div class="loading"></div>',utils.loadFile(document,{src:t.dataUrl+"&query="+e+"&page_size="+t.total+"&callback=music.callback()&.r="+Math.random(),tag:"script",type:"text/javascript",defer:"defer"})},_removeHtml:function(e){var t=/<\s*\/?\s*[^>]*\s*>/gi;return e.replace(t,"")},_getUrl:function(e){var t=this,n="from=tiebasongwidget&url=&name="+encodeURIComponent(t._removeHtml(i.title))+"&artist="+encodeURIComponent(t._removeHtml(i.author))+"&extra="+encodeURIComponent(t._removeHtml(i.album_title))+"&autoPlay="+e+"&loop=true";return t.playerUrl+"?"+n},_getTryingElem:function(){for(var e=$G("J_listPanel").getElementsByTagName("span"),t=0;e.length>t;t++)if("m-trying"==e[t].className)return e[t];return null},_buildMusicHtml:function(e){var t='<embed class="BDE_try_Music" allowfullscreen="false" pluginspage="http://www.macromedia.com/go/getflashplayer"';return t+=' src="'+e+'"',t+=' width="1" height="1" style="position:absolute;left:-2000px;"',t+=' type="application/x-shockwave-flash" wmode="transparent" play="true" loop="false"',t+=' menu="false" allowscriptaccess="never" scale="noborder">'},_byteLength:function(e){return e.replace(/[^\u0000-\u007f]/g,"aa").length},_getMaxText:function(e){var t=this;return e=t._removeHtml(e),t._byteLength(e)>12?e.substring(0,5)+"...":(e||(e="&nbsp;"),e)},_rebuildData:function(e){for(var t,i=this,n=[],o=i.pageSize,a=0;e.length>a;a++)0==(a+o)%o&&(t=[],n.push(t)),t.push(e[a]);return n},_renderTemplate:function(i){var n=this;if(0==i.length)return'<div class="empty">'+lang.emptyTxt+"</div>";i=n._rebuildData(i);var o=[],a=[],r=[];o.push('<div id="J_listPanel" class="listPanel">'),a.push('<div class="page">');for(var s,l=0;s=i[l++];){t.push("panel"+l),e.push("page"+l),1==l?(o.push('<div id="panel'+l+'" class="panelon">'),1!=i.length&&r.push('<div id="page'+l+'" onclick="music.onpageclick('+l+')" class="pageon">'+l+"</div>")):(o.push('<div id="panel'+l+'" class="paneloff">'),r.push('<div id="page'+l+'" onclick="music.onpageclick('+l+')" class="pageoff">'+l+"</div>")),o.push('<div class="m-box">'),o.push('<div class="m-h"><span class="m-t">'+lang.chapter+'</span><span class="m-s">'+lang.singer+'</span><span class="m-z">'+lang.special+'</span><span class="m-try-t">'+lang.listenTest+"</span></div>");for(var d,c=0;d=s[c++];)o.push('<label for="radio-'+l+"-"+c+'" class="m-m">'),o.push('<input type="radio" id="radio-'+l+"-"+c+'" name="musicId" class="m-l" onclick="music.doselect('+(n.pageSize*(l-1)+(c-1))+')"/>'),o.push('<span class="m-t">'+n._getMaxText(d.title)+"</span>"),o.push('<span class="m-s">'+n._getMaxText(d.author)+"</span>"),o.push('<span class="m-z">'+n._getMaxText(d.album_title)+"</span>"),o.push('<span class="m-try" onclick="music.doselect('+(n.pageSize*(l-1)+(c-1))+');music.listenTest(this)"></span>'),o.push("</label>");o.push("</div>"),o.push("</div>")}return r.reverse(),a.push(r.join("")),o.push("</div>"),a.push("</div>"),o.join("")+a.join("")},exec:function(){var e=this;null!=i&&($G("J_preview").innerHTML="",editor.execCommand("music",{url:e._getUrl(!1),width:400,height:95}))}}})();