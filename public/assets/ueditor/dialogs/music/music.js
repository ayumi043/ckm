function Music(){this.init()}(function(){var e=[],t=[],n=null;Music.prototype={total:70,pageSize:10,dataUrl:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common",playerUrl:"http://box.baidu.com/widget/flash/bdspacesong.swf",init:function(){var e=this;domUtils.on($G("J_searchName"),"keyup",function(t){var n=window.event||t;13==n.keyCode&&e.dosearch()}),domUtils.on($G("J_searchBtn"),"click",function(){e.dosearch()})},callback:function(e){var t=this;t.data=e.song_list,setTimeout(function(){$G("J_resultBar").innerHTML=t._renderTemplate(e.song_list)},300)},dosearch:function(){var e=this;n=null;var t=$G("J_searchName").value;return""==utils.trim(t)?!1:(t=encodeURIComponent(t),e._sent(t),void 0)},doselect:function(e){var t=this;"object"==typeof e?n=e:"number"==typeof e&&(n=t.data[e])},onpageclick:function(n){for(var i=0;e.length>i;i++)$G(e[i]).className="pageoff",$G(t[i]).className="paneloff";$G("page"+n).className="pageon",$G("panel"+n).className="panelon"},listenTest:function(e){var t=this,n=$G("J_preview"),i="m-try"==e.className,o=t._getTryingElem();o&&(o.className="m-try",n.innerHTML=""),i&&(e.className="m-trying",n.innerHTML=t._buildMusicHtml(t._getUrl(!0)))},_sent:function(e){var t=this;$G("J_resultBar").innerHTML='<div class="loading"></div>',utils.loadFile(document,{src:t.dataUrl+"&query="+e+"&page_size="+t.total+"&callback=music.callback()&.r="+Math.random(),tag:"script",type:"text/javascript",defer:"defer"})},_removeHtml:function(e){var t=/<\s*\/?\s*[^>]*\s*>/gi;return e.replace(t,"")},_getUrl:function(e){var t=this,i="from=tiebasongwidget&url=&name="+encodeURIComponent(t._removeHtml(n.title))+"&artist="+encodeURIComponent(t._removeHtml(n.author))+"&extra="+encodeURIComponent(t._removeHtml(n.album_title))+"&autoPlay="+e+"&loop=true";return t.playerUrl+"?"+i},_getTryingElem:function(){for(var e=$G("J_listPanel").getElementsByTagName("span"),t=0;e.length>t;t++)if("m-trying"==e[t].className)return e[t];return null},_buildMusicHtml:function(e){var t='<embed class="BDE_try_Music" allowfullscreen="false" pluginspage="http://www.macromedia.com/go/getflashplayer"';return t+=' src="'+e+'"',t+=' width="1" height="1" style="position:absolute;left:-2000px;"',t+=' type="application/x-shockwave-flash" wmode="transparent" play="true" loop="false"',t+=' menu="false" allowscriptaccess="never" scale="noborder">'},_byteLength:function(e){return e.replace(/[^\u0000-\u007f]/g,"aa").length},_getMaxText:function(e){var t=this;return e=t._removeHtml(e),t._byteLength(e)>12?e.substring(0,5)+"...":(e||(e="&nbsp;"),e)},_rebuildData:function(e){for(var t,n=this,i=[],o=n.pageSize,r=0;e.length>r;r++)0==(r+o)%o&&(t=[],i.push(t)),t.push(e[r]);return i},_renderTemplate:function(n){var i=this;if(0==n.length)return'<div class="empty">'+lang.emptyTxt+"</div>";n=i._rebuildData(n);var o=[],r=[],a=[];o.push('<div id="J_listPanel" class="listPanel">'),r.push('<div class="page">');for(var s,l=0;s=n[l++];){t.push("panel"+l),e.push("page"+l),1==l?(o.push('<div id="panel'+l+'" class="panelon">'),1!=n.length&&a.push('<div id="page'+l+'" onclick="music.onpageclick('+l+')" class="pageon">'+l+"</div>")):(o.push('<div id="panel'+l+'" class="paneloff">'),a.push('<div id="page'+l+'" onclick="music.onpageclick('+l+')" class="pageoff">'+l+"</div>")),o.push('<div class="m-box">'),o.push('<div class="m-h"><span class="m-t">'+lang.chapter+'</span><span class="m-s">'+lang.singer+'</span><span class="m-z">'+lang.special+'</span><span class="m-try-t">'+lang.listenTest+"</span></div>");for(var d,c=0;d=s[c++];)o.push('<label for="radio-'+l+"-"+c+'" class="m-m">'),o.push('<input type="radio" id="radio-'+l+"-"+c+'" name="musicId" class="m-l" onclick="music.doselect('+(i.pageSize*(l-1)+(c-1))+')"/>'),o.push('<span class="m-t">'+i._getMaxText(d.title)+"</span>"),o.push('<span class="m-s">'+i._getMaxText(d.author)+"</span>"),o.push('<span class="m-z">'+i._getMaxText(d.album_title)+"</span>"),o.push('<span class="m-try" onclick="music.doselect('+(i.pageSize*(l-1)+(c-1))+');music.listenTest(this)"></span>'),o.push("</label>");o.push("</div>"),o.push("</div>")}return a.reverse(),r.push(a.join("")),o.push("</div>"),r.push("</div>"),o.join("")+r.join("")},exec:function(){var e=this;null!=n&&($G("J_preview").innerHTML="",editor.execCommand("music",{url:e._getUrl(!1),width:400,height:95}))}}})();