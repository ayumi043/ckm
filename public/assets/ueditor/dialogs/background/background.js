function changeSelected(e){e.getAttribute("selected")?(e.removeAttribute("selected"),e.style.cssText="filter:alpha(Opacity=100);-moz-opacity:1;opacity: 1;border: 2px solid #fff"):(e.setAttribute("selected","true"),e.style.cssText="filter:alpha(Opacity=50);-moz-opacity:0.5;opacity: 0.5;border:2px solid blue;"),$G("url").value=e.getAttribute("src")}function scale(e,t,n,i){var o,r=0,a=0,s=e.width||n,l=e.height||i;(s>t||l>t)&&(s>=l?(r=s-t)&&(o=(r/s).toFixed(2),e.height=l-l*o,e.width=t):(a=l-t)&&(o=(a/l).toFixed(2),e.width=s-s*o,e.height=t))}function initSelfPos(){var e,t;if(browser.ie)e=domUtils.getComputedStyle(doc.body,"background-position-x").replace(/50%|%|px|center/gi,""),t=domUtils.getComputedStyle(doc.body,"background-position-y").replace(/50%|%|px|center/gi,"");else{var n=domUtils.getComputedStyle(doc.body,"background-position").match(/\s?(\d*)px/gi);n&&n.length&&(e=n[0].replace("px",""),t=n[1].replace("px",""))}$G("x").value=e||0,$G("y").value=t||0}function initImgUrl(){var e=domUtils.getComputedStyle(doc.body,"background-image"),t="";e.indexOf(me.options.imagePath)>0?(t=e.match(/url\("?(.*[^\)"])"?/i),t&&t.length&&(t=t[1].substring(t[1].indexOf(me.options.imagePath),t[1].length))):t="none"!=e?e.replace(/url\("?|"?\)/gi,""):"",$G("url").value=t}function initAlign(){var e=domUtils.getComputedStyle(doc.body,"background-repeat"),t=$G("repeatType");if("no-repeat"==e){var n=domUtils.getComputedStyle(doc.body,browser.ie?"background-position-x":"background-position");t.value=n&&n.match(/\s?(\d*)px/gi)?"self":"center","center"==n&&(t.value="center"),$G("custom").style.display="self"==t.value?"":"none"}else t.value=e}function getCheckIpt(){for(var e,t=document.getElementsByName("t"),n=0;e=t[n++];)if(e.checked)return e.value}var me=editor,doc=me.document,bodyStyle,cp=$G("colorPicker"),bkbodyStyle="",bkcolor="",popup=new UE.ui.Popup({content:new UE.ui.ColorPicker({noColorText:me.getLang("clearColor"),editor:me,onpickcolor:function(e,t){domUtils.setStyle(cp,"background-color",t),bkcolor=t,UE.ui.Popup.postHide()},onpicknocolor:function(){domUtils.setStyle(cp,"background-color","transparent"),bkcolor="",UE.ui.Popup.postHide()}}),editor:me,onhide:function(){setBody()}});domUtils.on(cp,"click",function(){popup.showAnchor(this)}),domUtils.on(document,"mousedown",function(e){var t=e.target||e.srcElement;UE.ui.Popup.postHide(t)}),domUtils.on(window,"scroll",function(){UE.ui.Popup.postHide()});var getHead=function(){return domUtils.getElementsByTagName($G("tabHeads"),"span")},bindClick=function(){for(var e,t=getHead(),n=0;e=t[n++];)e.onclick=function(){var e=this.getAttribute("tabsrc");if(toggleHead(this),toggleBody(e),"imgManager"==e)ajax.request(editor.options.imageManagerUrl,{timeout:1e5,action:"get",onsuccess:function(e){var t=utils.trim(e.responseText),n=t?t.split("ue_separate_ue"):[],i=n.length,o=$G("imageList");o.innerHTML=i?"":"&nbsp;&nbsp;"+lang.noUploadImage;for(var r,a=0;r=n[a++];){var s=document.createElement("img"),l=document.createElement("div");l.appendChild(s),l.style.display="none",o.appendChild(l),s.onclick=function(){for(var e,t=o.childNodes,n=0;e=t[n++];)e.firstChild.removeAttribute("selected"),e.firstChild.style.cssText="filter:alpha(Opacity=100);-moz-opacity:1;opacity: 1;border: 2px solid #fff";changeSelected(this)},s.onload=function(){this.parentNode.style.display="";var e=this.width,t=this.height;scale(this,95,120,80),this.title=lang.toggleSelect+e+"X"+t},s.setAttribute(35>a?"src":"lazy_src",editor.options.imageManagerPath+r.replace(/\s+|\s+/gi,"")),s.setAttribute("data_ue_src",editor.options.imageManagerPath+r.replace(/\s+|\s+/gi,""))}},onerror:function(){$G("imageList").innerHTML=lang.imageLoadError}});else for(var t,n=document.getElementsByName("t"),i=0;t=n[i++];)t.checked&&"none"!=t.value&&($G("repeatType").style.display="",net(t))}},toggleBody=function(e){for(var t,n=["normal","imgManager"],i=0;t=n[i++];)$G(t).style.zIndex=t==e?200:1},toggleHead=function(e){for(var t,n=getHead(),i=0;t=n[i++];)domUtils.removeClasses(t,["focus"]),$G("repeatType").style.display="none";domUtils.addClass(e,"focus")},getCheckedTab=function(){for(var e,t=getHead(),n=0;e=t[n++];)if(domUtils.hasClass(e,"focus"))return e},init=function(){bindClick();var e=getHead()[0],t=e.getAttribute("tabsrc");toggleHead(e),toggleBody(t),$G("alignment").style.display="none",$G("custom").style.display="none",domUtils.setStyle(cp,"background-color",domUtils.getComputedStyle(doc.body,"background-color"));var n=domUtils.getComputedStyle(doc.body,"background-color");(n&&"#ffffff"!=n&&"transparent"!=n||"none"!=domUtils.getComputedStyle(doc.body,"background-image"))&&setTimeout(function(){document.getElementsByName("t")[1].click()},200),initImgUrl(),initSelfPos(),initAlign()};init();var net=function(e){var t=$G("alignment"),n=$G("url"),i=$G("custom");"none"==e.value?(t.style.display="none",i.style.display="none",browser.ie?n.onpropertychange=null:n.removeEventListener("input",setBody)):(bindSelfPos(),$G("repeatType").style.display="",t.style.display="",browser.ie?n.onpropertychange=setBody:n.addEventListener("input",setBody,!1)),setBody()},bindSelfPos=function(){function e(e,t){e=e||event,38==e.keyCode||40==e.keyCode?(t.value=38==e.keyCode?parseInt(t.value)+1:parseInt(t.value)-1,0>t.value&&(t.value=0)):48>e.keyCode&&e.keyCode>57&&domUtils.preventDefault(e),setBody()}var t=$G("x"),n=$G("y");domUtils.on(t,["propertychange","input","keydown"],function(t){e(t,this)}),domUtils.on(n,["propertychange","input","keydown"],function(t){e(t,this)})},showAlign=function(){$G("alignment").style.display=""},selectAlign=function(e){$G("custom").style.display="self"==e.value?"":"none",setBody()},setBody=function(){var e=domUtils.getStyle(cp,"background-color"),t=$G("url").value,n=$G("repeatType").value,i={"background-repeat":"no-repeat","background-position":"center center"},o=[];switch(e&&(i["background-color"]=e),t&&(i["background-image"]='url("'+t+'")'),n){case"repeat-x":i["background-repeat"]="repeat-x;";break;case"repeat-y":i["background-repeat"]="repeat-y;";break;case"repeat":i["background-repeat"]="repeat;";break;case"self":i["background-position"]=$G("x").value+"px "+$G("y").value+"px"}for(var r in i)i.hasOwnProperty(r)&&o.push(r+":"+i[r]);"none"!=getCheckIpt()?utils.cssRule("body","body{"+o.join(";")+"}",doc):utils.cssRule("body","",doc)};dialog.onok=function(){setBody()},dialog.oncancel=function(){utils.cssRule("body",bkbodyStyle,doc)},bkbodyStyle=utils.cssRule("body",void 0,doc);