var SWFUpload;"function"==typeof SWFUpload&&(SWFUpload.speed={},SWFUpload.prototype.initSettings=function(e){return function(t){"function"==typeof e&&e.call(this,t),this.ensureDefault=function(e,n){this.settings[e]=void 0==t[e]?n:t[e]},this.fileSpeedStats={},this.speedSettings={},this.ensureDefault("moving_average_history_size","10"),this.speedSettings.user_file_queued_handler=this.settings.file_queued_handler,this.speedSettings.user_file_queue_error_handler=this.settings.file_queue_error_handler,this.speedSettings.user_upload_start_handler=this.settings.upload_start_handler,this.speedSettings.user_upload_error_handler=this.settings.upload_error_handler,this.speedSettings.user_upload_progress_handler=this.settings.upload_progress_handler,this.speedSettings.user_upload_success_handler=this.settings.upload_success_handler,this.speedSettings.user_upload_complete_handler=this.settings.upload_complete_handler,this.settings.file_queued_handler=SWFUpload.speed.fileQueuedHandler,this.settings.file_queue_error_handler=SWFUpload.speed.fileQueueErrorHandler,this.settings.upload_start_handler=SWFUpload.speed.uploadStartHandler,this.settings.upload_error_handler=SWFUpload.speed.uploadErrorHandler,this.settings.upload_progress_handler=SWFUpload.speed.uploadProgressHandler,this.settings.upload_success_handler=SWFUpload.speed.uploadSuccessHandler,this.settings.upload_complete_handler=SWFUpload.speed.uploadCompleteHandler,delete this.ensureDefault}}(SWFUpload.prototype.initSettings),SWFUpload.speed.fileQueuedHandler=function(e){return"function"==typeof this.speedSettings.user_file_queued_handler?(e=SWFUpload.speed.extendFile(e),this.speedSettings.user_file_queued_handler.call(this,e)):void 0},SWFUpload.speed.fileQueueErrorHandler=function(e,t,n){return"function"==typeof this.speedSettings.user_file_queue_error_handler?(e=SWFUpload.speed.extendFile(e),this.speedSettings.user_file_queue_error_handler.call(this,e,t,n)):void 0},SWFUpload.speed.uploadStartHandler=function(e){return"function"==typeof this.speedSettings.user_upload_start_handler?(e=SWFUpload.speed.extendFile(e,this.fileSpeedStats),this.speedSettings.user_upload_start_handler.call(this,e)):void 0},SWFUpload.speed.uploadErrorHandler=function(e,t,n){return e=SWFUpload.speed.extendFile(e,this.fileSpeedStats),SWFUpload.speed.removeTracking(e,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_error_handler?this.speedSettings.user_upload_error_handler.call(this,e,t,n):void 0},SWFUpload.speed.uploadProgressHandler=function(e,t,n){return this.updateTracking(e,t),e=SWFUpload.speed.extendFile(e,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_progress_handler?this.speedSettings.user_upload_progress_handler.call(this,e,t,n):void 0},SWFUpload.speed.uploadSuccessHandler=function(e,t){return"function"==typeof this.speedSettings.user_upload_success_handler?(e=SWFUpload.speed.extendFile(e,this.fileSpeedStats),this.speedSettings.user_upload_success_handler.call(this,e,t)):void 0},SWFUpload.speed.uploadCompleteHandler=function(e){return e=SWFUpload.speed.extendFile(e,this.fileSpeedStats),SWFUpload.speed.removeTracking(e,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_complete_handler?this.speedSettings.user_upload_complete_handler.call(this,e):void 0},SWFUpload.speed.extendFile=function(e,t){var n;return e?(t&&(n=t[e.id]),n?(e.currentSpeed=n.currentSpeed,e.averageSpeed=n.averageSpeed,e.movingAverageSpeed=n.movingAverageSpeed,e.timeRemaining=n.timeRemaining,e.timeElapsed=n.timeElapsed,e.percentUploaded=n.percentUploaded,e.sizeUploaded=n.bytesUploaded):(e.currentSpeed=0,e.averageSpeed=0,e.movingAverageSpeed=0,e.timeRemaining=0,e.timeElapsed=0,e.percentUploaded=0,e.sizeUploaded=0),e):e},SWFUpload.prototype.updateTracking=function(e,t){var n=this.fileSpeedStats[e.id];n||(this.fileSpeedStats[e.id]=n={}),t=t||n.bytesUploaded||0,0>t&&(t=0),t>e.size&&(t=e.size);var i=(new Date).getTime();if(n.startTime)if(n.startTime>i)this.debug("When backwards in time");else{var o=(new Date).getTime(),r=n.lastTime,a=o-r,s=t-n.bytesUploaded;if(0===s||0===a)return n;n.lastTime=o,n.bytesUploaded=t,n.currentSpeed=8*s/(a/1e3),n.averageSpeed=8*n.bytesUploaded/((o-n.startTime)/1e3),n.movingAverageHistory.push(n.currentSpeed),n.movingAverageHistory.length>this.settings.moving_average_history_size&&n.movingAverageHistory.shift(),n.movingAverageSpeed=SWFUpload.speed.calculateMovingAverage(n.movingAverageHistory),n.timeRemaining=8*(e.size-n.bytesUploaded)/n.movingAverageSpeed,n.timeElapsed=(o-n.startTime)/1e3,n.percentUploaded=100*(n.bytesUploaded/e.size)}else n.startTime=(new Date).getTime(),n.lastTime=n.startTime,n.currentSpeed=0,n.averageSpeed=0,n.movingAverageSpeed=0,n.movingAverageHistory=[],n.timeRemaining=0,n.timeElapsed=0,n.percentUploaded=t/e.size,n.bytesUploaded=t;return n},SWFUpload.speed.removeTracking=function(e,t){try{t[e.id]=null,delete t[e.id]}catch(n){}},SWFUpload.speed.formatUnits=function(e,t,n,i){var o,r,a,s;if(0===e)return"0 "+n[n.length-1];if(i){for(r=e,s=n.length>=t.length?n[t.length-1]:"",o=0;t.length>o;o++)if(e>=t[o]){r=(e/t[o]).toFixed(2),s=n.length>=o?" "+n[o]:"";break}return r+s}var l=[],d=e;for(o=0;t.length>o;o++)a=t[o],s=n.length>o?" "+n[o]:"",r=d/a,r=t.length-1>o?Math.floor(r):r.toFixed(2),r>0&&(d%=a,l.push(r+s));return l.join(" ")},SWFUpload.speed.formatBPS=function(e){var t=[1073741824,1048576,1024,1],n=["Gbps","Mbps","Kbps","bps"];return SWFUpload.speed.formatUnits(e,t,n,!0)},SWFUpload.speed.formatTime=function(e){var t=[86400,3600,60,1],n=["d","h","m","s"];return SWFUpload.speed.formatUnits(e,t,n,!1)},SWFUpload.speed.formatBytes=function(e){var t=[1073741824,1048576,1024,1],n=["GB","MB","KB","bytes"];return SWFUpload.speed.formatUnits(e,t,n,!0)},SWFUpload.speed.formatPercent=function(e){return e.toFixed(2)+" %"},SWFUpload.speed.calculateMovingAverage=function(e){var t,n,i=[],o=0,r=0,a=0,s=0,l=0,d=0,c=0;if(t=e.length,t>=8){for(n=0;t>n;n++)i[n]=e[n],o+=i[n];for(r=o/t,n=0;t>n;n++)a+=Math.pow(i[n]-r,2);for(s=a/t,l=Math.sqrt(s),n=0;t>n;n++)i[n]=(i[n]-r)/l;var u=2;for(n=0;t>n;n++)u>=i[n]&&i[n]>=-u&&(c++,d+=e[n])}else for(c=t,n=0;t>n;n++)d+=e[n];return d/c});